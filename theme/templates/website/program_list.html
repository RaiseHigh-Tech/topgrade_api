{% extends 'website/base.html' %}
{% load static %}

{% block title %}
  All Programs - TopGrade
{% endblock %}

{% block content %}
  <style>
    @keyframes scroll-text {
      0% {
        transform: translateX(0);
      }
    
      100% {
        transform: translateX(-50%);
      }
    }
    
    .animate-scroll-text {
      animation: scroll-text 30s linear infinite;
    }
    
    /* Faster on mobile */
    @media (max-width: 768px) {
      .animate-scroll-text {
        animation: scroll-text 15s linear infinite;
        /* increase speed */
      }
    }
    .hero-grid-background {
      background-color: #1c120a;
      background-image: linear-gradient(rgba(239, 125, 0, 0.15) 1px, transparent 1px), linear-gradient(90deg, rgba(239, 125, 0, 0.15) 1px, transparent 1px), linear-gradient(180deg, #2c1e12 0%, #1c120a 100%);
      background-size: 50px 50px, 50px 50px, 100% 100%;
      background-position: -1px -1px, -1px -1px, 0 0;
    }
    
    .program-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .program-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }
    
    .crown-badge {
      background: linear-gradient(45deg, #ffd700, #ffed4e);
      color: #b45309;
      border: 2px solid #fbbf24;
      box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
    }
    
    .filter-btn {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .filter-btn.active {
      background-color: #f07c00 !important;
      color: white !important;
    }
    
    .search-section {
      background: linear-gradient(135deg, #2c1e12 0%, #1c120a 100%);
    }
    
    .stats-card {
      background: linear-gradient(135deg, rgba(240, 124, 0, 0.9) 0%, rgba(239, 125, 0, 0.8) 100%);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
  </style>

  <!-- HERO SECTION -->
  <section class="hero-grid-background text-white py-16 md:py-24">
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-4xl md:text-6xl font-bold mb-6">Explore All <span class="text-[#d97706]">Programs</span></h1>
      <p class="text-xl md:text-2xl text-white/80 max-w-3xl mx-auto mb-8">Discover our complete collection of industry-leading courses designed to accelerate your career</p>

      <!-- Stats Cards -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto">
        <div class="stats-card p-4 rounded-xl text-center">
          <div class="text-2xl md:text-3xl font-bold">{{ total_programs }}</div>
          <div class="text-sm text-white/80">Total Programs</div>
        </div>
        <div class="stats-card p-4 rounded-xl text-center">
          <div class="text-2xl md:text-3xl font-bold">{{ regular_programs_count }}</div>
          <div class="text-sm text-white/80">Regular Programs</div>
        </div>
        <div class="stats-card p-4 rounded-xl text-center">
          <div class="text-2xl md:text-3xl font-bold">{{ advanced_programs_count }}</div>
          <div class="text-sm text-white/80">Advanced Programs</div>
        </div>
        <div class="stats-card p-4 rounded-xl text-center">
          <div class="text-2xl md:text-3xl font-bold">{{ bestseller_count }}</div>
          <div class="text-sm text-white/80">Best Sellers</div>
        </div>
      </div>
    </div>
  </section>

  <!-- CATEGORIES MARQUEE -->
  <section class="py-4 border-y border-orange-300/50">
    <div class="bg-[#e47f00] overflow-hidden">
      <div class="flex animate-scroll-text whitespace-nowrap py-3 text-white">
        <div class="flex items-center">
          <span class="font-semibold mx-6">WEB DEVELOPMENT</span><span class="text-white/70 text-xl mx-6 animate-spin [animation-duration:10s]">&#10022;</span><span class="font-semibold mx-6">CAREER ADVICE</span><span class="text-white/70 text-xl mx-6 animate-spin [animation-duration:10s]">&#10022;</span><span class="font-semibold mx-6">CYBERSECURITY</span><span class="text-white/70 text-xl mx-6 animate-spin [animation-duration:10s]">&#10022;</span><span class="font-semibold mx-6">PYTHON</span><span class="text-white/70 text-xl mx-6 animate-spin [animation-duration:10s]">&#10022;</span><span class="font-semibold mx-6">DATA SCIENCE</span><span class="text-white/70 text-xl mx-6 animate-spin [animation-duration:10s]">&#10022;</span>
        </div>
        <div class="flex items-center" aria-hidden="true">
          <span class="font-semibold mx-6">WEB DEVELOPMENT</span><span class="text-white/70 text-xl mx-6 animate-spin [animation-duration:10s]">&#10022;</span><span class="font-semibold mx-6">CAREER ADVICE</span><span class="text-white/70 text-xl mx-6 animate-spin [animation-duration:10s]">&#10022;</span><span class="font-semibold mx-6">CYBERSECURITY</span><span class="text-white/70 text-xl mx-6 animate-spin [animation-duration:10s]">&#10022;</span><span class="font-semibold mx-6">PYTHON</span><span class="text-white/70 text-xl mx-6 animate-spin [animation-duration:10s]">&#10022;</span><span class="font-semibold mx-6">DATA SCIENCE</span><span class="text-white/70 text-xl mx-6 animate-spin [animation-duration:10s]">&#10022;</span>
        </div>
      </div>
    </div>
  </section>

  <!-- SEARCH AND FILTERS SECTION -->
  <section class="search-section py-8">
    <div class="container mx-auto px-4">
      <div class="max-w-6xl mx-auto">
        <!-- Search Bar -->
        <div class="mb-6">
          <div class="relative max-w-2xl mx-auto">
            <input type="text" id="searchInput" placeholder="Search programs by name..." class="w-full px-6 py-4 rounded-2xl bg-white/10 backdrop-blur-sm border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-[#ef7d00] focus:border-transparent" />
            <i class="fa-solid fa-search absolute right-6 top-1/2 transform -translate-y-1/2 text-white/60"></i>
          </div>
        </div>

        <!-- Filter Buttons -->
        <div class="flex flex-wrap justify-center gap-3 mb-6">
          <button class="filter-btn px-6 py-3 rounded-xl bg-white/10 text-white font-semibold active" data-filter="all"><i class="fa-solid fa-th-large mr-2"></i>All Programs</button>
          <button class="filter-btn px-6 py-3 rounded-xl bg-white/10 text-white/80 font-semibold" data-filter="regular"><i class="fa-solid fa-book mr-2"></i>Regular Programs</button>
          <button class="filter-btn px-6 py-3 rounded-xl bg-white/10 text-white/80 font-semibold" data-filter="advanced"><i class="fa-solid fa-crown mr-2"></i>Advanced Programs</button>
          <button class="filter-btn px-6 py-3 rounded-xl bg-white/10 text-white/80 font-semibold" data-filter="bestseller"><i class="fa-solid fa-fire mr-2"></i>Best Sellers</button>
        </div>
      </div>
    </div>
  </section>

  <!-- PROGRAMS GRID SECTION -->
  <section class="bg-[#2c1e12] py-16">
    <div class="container mx-auto px-4">
      <!-- Programs Grid -->
      <div id="programsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {% for program in programs %}
          {# prettier-ignore #}
          <div class="program-card bg-white rounded-xl shadow-lg overflow-hidden flex flex-col group"
            data-category="{{ program.category.id }}"
            data-type="{% if program.category.name == 'Advanced Program' %}advanced{% else %}regular{% endif %}{% if program.is_best_seller %} bestseller{% endif %}"
            data-title="{{ program.title|lower }}"
            data-rating="{{ program.program_rating }}"
            data-price="{{ program.price }}"
            data-created="{{ program.created_at|date:'Y-m-d' }}">
            <div class="relative">
              {% if program.image %}
                <img src="{{ program.image.url }}" alt="{{ program.title }}" class="w-full h-48 object-cover" loading="lazy" />
              {% else %}
                <div class="w-full h-48 bg-gray-300 flex items-center justify-center">
                  <i class="fa-solid fa-graduation-cap text-4xl text-white"></i>
                </div>
              {% endif %}

              <div class="absolute inset-0 bg-black/60 flex items-end p-4">
                <h3 class="text-white text-xl font-bold">{{ program.subtitle|default:program.title }}</h3>
              </div>

              <!-- Badges -->
              <div class="absolute top-3 right-3 flex flex-col gap-2">
                {% if program.category.name == 'Advanced Program' %}
                  <span class="crown-badge text-xs font-semibold px-3 py-1 rounded-full flex items-center"><i class="fa-solid fa-crown mr-1"></i>Advanced</span>
                {% endif %}
                {% if program.is_best_seller %}
                  <span class="bg-[#f07c00] text-white text-xs font-semibold px-3 py-1 rounded-full">Best Seller</span>
                {% endif %}
              </div>
            </div>

            <div class="p-6 flex-grow flex flex-col">
              <!-- Rating -->
              <div class="flex items-center text-yellow-500 mb-3">
                {# prettier-ignore #}
                {% for i in "12345" %}
                  {% if forloop.counter <= program.program_rating %}
                    <i class="fa-solid fa-star"></i>
                  {% else %}
                    <i class="fa-regular fa-star text-gray-300"></i>
                  {% endif %}
                {% endfor %}
                <span class="ml-2 text-sm text-gray-600">({{ program.program_rating }})</span>
              </div>

              <!-- Program Details -->
              <div class="flex flex-wrap gap-2 my-4">
                <span class="bg-gray-100 text-gray-700 text-sm px-3 py-1 rounded-full flex items-center"><i class="fa-solid fa-calendar-days mr-2"></i>{{ program.duration }}</span>
                {% if program.available_slots %}
                  <span class="bg-blue-100 text-blue-700 text-sm px-3 py-1 rounded-full flex items-center"><i class="fa-solid fa-users mr-2"></i>{{ program.available_slots }} slots</span>
                {% endif %}
              </div>

              {% if program.batch_starts %}
                <div class="text-sm text-gray-500 mb-2">
                  <i class="fa-solid fa-play mr-1"></i>Batch starts: {{ program.batch_starts }}
                </div>
              {% endif %}

              <!-- Price -->
              <div class="mb-4">
                {% if program.discount_percentage > 0 %}
                  <!-- Price with discount -->
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                      <div class="text-2xl font-bold text-[#f07c00]">₹{{ program.discounted_price|floatformat:0 }}</div>
                      <div class="text-lg text-gray-500 line-through">₹{{ program.price|floatformat:0 }}</div>
                    </div>
                    <span class="bg-green-100 text-green-700 text-xs font-medium px-2 py-1 rounded-full">{{ program.discount_percentage|floatformat:0 }}% OFF</span>
                  </div>
                {% else %}
                  <!-- Regular price without discount -->
                  <div class="text-2xl font-bold text-[#f07c00]">₹{{ program.price|floatformat:0 }}</div>
                {% endif %}
              </div>
              <hr class="my-2" />
              <a href="{% url 'program_detail' program.id %}" class="mt-2 text-[#f07c00] font-semibold flex items-center group-hover:text-[#d36c00] transition">
                Know More
                <i class="fa-solid fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
              </a>
            </div>
          </div>
        {% empty %}
          <div class="col-span-full text-center py-12">
            <i class="fa-solid fa-graduation-cap text-6xl text-gray-400 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">No Programs Available</h3>
            <p class="text-gray-500">Check back later for new programs!</p>
          </div>
        {% endfor %}
      </div>

      <!-- No Results Message -->
      <div id="noResults" class="text-center py-12 hidden">
        <i class="fa-solid fa-search text-6xl text-gray-400 mb-4"></i>
        <h3 class="text-xl font-semibold text-white mb-2">No Programs Found</h3>
        <p class="text-white/70">Try adjusting your search criteria or filters</p>
      </div>
    </div>
  </section>

  <!-- CTA SECTION -->
  <section class="bg-gradient-to-br from-[#d97706] to-[#4d2c0d] text-white py-16">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">Ready to Start Your Journey?</h2>
      <p class="text-xl text-white/90 mb-8 max-w-2xl mx-auto">Join thousands of students who have transformed their careers with our expert-led programs</p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="{% url 'contact' %}" class="bg-white text-[#ef7d00] px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">Get Free Consultation</a>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const searchInput = document.getElementById('searchInput')
      const filterBtns = document.querySelectorAll('.filter-btn')
      const programCards = document.querySelectorAll('.program-card')
      const noResults = document.getElementById('noResults')
    
      let currentFilter = 'all'
    
      function filterPrograms() {
        const searchTerm = searchInput.value.toLowerCase()
        let visibleCards = []
    
        // Filter programs
        programCards.forEach((card) => {
          const title = card.dataset.title
          const type = card.dataset.type
    
          let showCard = true
    
          // Search filter
          if (searchTerm && !title.includes(searchTerm)) {
            showCard = false
          }
    
          // Type filter
          if (currentFilter !== 'all') {
            if (currentFilter === 'advanced' && !type.includes('advanced')) {
              showCard = false
            } else if (currentFilter === 'regular' && type.includes('advanced')) {
              showCard = false
            } else if (currentFilter === 'bestseller' && !type.includes('bestseller')) {
              showCard = false
            }
          }
    
          if (showCard) {
            visibleCards.push(card)
            card.style.display = 'block'
          } else {
            card.style.display = 'none'
          }
        })
    
        // Show/hide no results message
        if (visibleCards.length === 0) {
          noResults.classList.remove('hidden')
        } else {
          noResults.classList.add('hidden')
        }
      }
    
      // Filter button event listeners
      filterBtns.forEach((btn) => {
        btn.addEventListener('click', function () {
          // Remove active class from all buttons
          filterBtns.forEach((b) => b.classList.remove('active'))
          // Add active class to clicked button
          this.classList.add('active')
    
          currentFilter = this.dataset.filter
          filterPrograms()
        })
      })
    
      // Search event listener
      searchInput.addEventListener('input', filterPrograms)
    })
  </script>
{% endblock %}
